# -----------------------------------------------------------------------------
# ExternalSecret - Basic example fetching individual keys
# -----------------------------------------------------------------------------
# Fetches specific properties from a JSON secret in Secrets Manager

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: database-credentials
  namespace: app
spec:
  # How often to sync from Secrets Manager
  refreshInterval: 1h
  
  # Reference to SecretStore or ClusterSecretStore
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore  # or SecretStore for namespace-scoped
  
  # Target Kubernetes Secret to create
  target:
    name: database-credentials
    creationPolicy: Owner  # ESO owns and manages this secret
  
  # Map external secret properties to K8s secret keys
  data:
    - secretKey: username
      remoteRef:
        key: app/database  # Secret name in Secrets Manager
        property: username # JSON property to extract
    
    - secretKey: password
      remoteRef:
        key: app/database
        property: password
    
    - secretKey: host
      remoteRef:
        key: app/database
        property: host
    
    - secretKey: port
      remoteRef:
        key: app/database
        property: port
