# HTTPRoute - Traffic Splitting (Native, no annotations!)
# This is a key advantage over Ingress

# Weight-based traffic splitting for canary deployments
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: canary-route
  namespace: default
spec:
  parentRefs:
  - name: main-gateway
    namespace: infra
  hostnames:
  - "app.example.com"
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /
    backendRefs:
    # 90% to stable
    - name: app-stable
      port: 80
      weight: 90
    # 10% to canary
    - name: app-canary
      port: 80
      weight: 10

---
# Blue-Green deployment (100% switch)
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: blue-green-route
  namespace: default
spec:
  parentRefs:
  - name: main-gateway
    namespace: infra
  hostnames:
  - "app.example.com"
  rules:
  - backendRefs:
    # Switch weights to flip between blue and green
    - name: app-blue
      port: 80
      weight: 100  # Active
    - name: app-green
      port: 80
      weight: 0    # Standby

---
# A/B testing - split between feature versions
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: ab-test-route
  namespace: default
spec:
  parentRefs:
  - name: main-gateway
    namespace: infra
  hostnames:
  - "app.example.com"
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /checkout
    backendRefs:
    # 50/50 split for A/B test
    - name: checkout-v1
      port: 80
      weight: 50
    - name: checkout-v2
      port: 80
      weight: 50
